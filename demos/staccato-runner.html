<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<!--
staccato-runner.html (part of Era)
Copyright 2015 Ross Angle. Released under the MIT License.
-->
<title>Era Staccato demo</title>
</head>
<body>
<p><a href="https://github.com/rocketnia/era"
    >View the Era project on GitHub.</a></p>

<p>This page merely loads Staccato without actually using it for much.
Check the console to see if there are errors. If there aren't, great!
Nothing to see here.</p>

<p>This page loads the Staccato source code from a file called
"fin/era-staccato-lib.stc.js" in the repo directory. To use this page,
you must obtain era-staccato-lib.stc.js in one of two ways:</p>

<ul>
    <li>Install Node.js. From the repo directory, run the command
    "<kbd>npm install</kbd>" followed by the command
    "<kbd>node build-era.js --build-staccato</kbd>".</li>
    <li>Check out the <code>gh-pages</code> branch, which contains the
    files automatically built by Travis CI.</li>
</ul>

<p>Alternatively, you can view the latest version of this page
<a href="http://rocketnia.github.io/era/demos/staccato-runner.html"
>online</a>.</p>

<script type="text/javascript" src="../fin/era-staccato-lib.stc.js">
    </script>
<script type="text/javascript" src="../fin/test.stc.js"></script>
<script type="text/javascript" src="../src/era-misc-strmap-avl.js">
    </script>
<script type="text/javascript" src="../src/era-misc.js"></script>
<script type="text/javascript" src="../src/era-reader.js"></script>
<script type="text/javascript" src="../src/era-staccato.js"></script>
<script type="text/javascript"
    src="../src/era-staccato-builders-gensym.js"></script>
<script type="text/javascript"
    src="../src/era-staccato-lib-runner.js"></script>
<script type="text/javascript">"use strict";

window.onload = function () {
    function generateOutput() {
        var startMillis = new Date().getTime();
        
        var mainCode =
            readAll( rocketnia.eraFiles[ "era-staccato-lib.stc" ] );
        var testCode =
            readAll( rocketnia.eraFiles[ "test.stc" ] );
        var readMillis = new Date().getTime();
        
        function runCode( code ) {
            return !arrAny( code, function ( tryExpr ) {
                if ( !tryExpr.ok ) {
                    console.err( tryExpr.msg );
                    return true;
                }
                
                processTopLevelReaderExpr( tryExpr.val );
                return false;
            } );
        }
        
        if ( runCode( mainCode ) ) {
            runAllDefs();
            runCode( testCode );
        }
        
        
        var stopMillis = new Date().getTime();
        // TODO: Either remove this or display it more prominently.
        console.log(
            "Ran for " + (stopMillis - startMillis) / 1000 + " " +
            "seconds, broken down as follows:" );
        console.log(
            "- Spent " + (readMillis - startMillis) / 1000 + " " +
            "seconds reading the code." );
        console.log(
            "- Spent " + (stopMillis - readMillis) / 1000 + " " +
            "seconds processing it, broken down as follows:" );
        console.log(
            "- - Parsing: " + timeSpentParsing / 1000 + " seconds" );
        console.log(
            "- - Compiling: " + timeSpentCompiling / 1000 + " " +
            "seconds" );
        console.log(
            "- - Installing: " + timeSpentInstalling / 1000 + " " +
            "seconds" );
        console.log(
            "- - Evaluating test expressions: " +
            timeSpentEvaluatingForTest / 1000 + " seconds" );
        console.log(
            "- - Desugaring defn: " +
            timeSpentDesugaringDefn / 1000 + " seconds" );
        console.log(
            "- - - Calling parseSyntax: " +
            timeSpentParsingSyntax / 1000 + " seconds" );
        console.log(
            "- - - Other: " +
            (timeSpentDesugaringDefn - timeSpentParsingSyntax) /
                1000 + " " +
            "seconds" );
        console.log(
            "- - Other: " +
            (stopMillis - readMillis -
                timeSpentParsing -
                timeSpentCompiling -
                timeSpentInstalling -
                timeSpentEvaluatingForTest -
                timeSpentDesugaringDefn) / 1000 +
            " " +
            "seconds" );
    }
    generateOutput();
};
</script>
</body>
</html>
